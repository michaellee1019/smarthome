---

- name: install httpd
  become_user: root
  become: yes
  apt:
    name: apache2
    state: present

- name: enable mod_rewrite
  become_user: root
  become: yes
  apache2_module:
    name: rewrite
    state: present

- name: enable mod_status
  become_user: root
  become: yes
  apache2_module:
    name: status
    state: present

- name: enable mod_headers
  become_user: root
  become: yes
  apache2_module:
    name: headers
    state: present

- name: install smarthome apache config
  become_user: root
  become: true
  template:
    src: 001-smarthome.conf.j2
    dest: /etc/apache2/sites-available/001-smarthome.conf
    owner: root
    group: root
    mode: 0664

- name: enable smarthome apache config
  become_user: root
  become: true
  command: a2ensite 001-smarthome
  args:
    creates: /etc/apache2/sites-enabled/001-smarthome.conf
  notify:
  - restart apache2

- name: disable default apache config
  become_user: root
  become: true
  command: a2dissite 000-default
  args:
    removes: /etc/apache2/sites-enabled/000-default.conf

- name: enable service httpd and ensure it is not masked
  systemd:
    name: apache2
    enabled: yes
    masked: no
